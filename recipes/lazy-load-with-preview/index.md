---
title: "Ленивая загрузка картинок с цветным превью"
description: "Как добавить цветное превью при ленивой загрузки изображения."
authors:
  - prorokky
related:
  - js/intersection-observer
  - html/img
  - css/background-color
tags:
  - article
---

## Задача

_Ленивая загрузка (lazy loadnig)_ — это асинхронная загрузка картинок на веб-странице. Это означает, что картинки загружаются после полной загрузки страницы или когда они появляются в видимой части окна браузера. Следовательно, если пользователь не будет прокручивать экран, то изображения, размещённые за пределами экрана, не будут загружаться.

Иногда хочется, чтобы изображение появлялось не внезапно, а чтобы пользователь заранее знал, что оно там будет благодаря превью.

Ленивую загрузку часто используют на сайтах с большим количеством изображений. Таким образом можно экономить трафик на сайт и повысить производительность.

При большом количетво изображений на сайте можно настроить приоритет их загрузки. Для можно использовать атрибут `fetch-priority` в теге [`<img>`](/html/img/). Всего у атрибута есть 3 значения:

1. high - высокий приоритет относительно других изображений.
2. low - низкий приоритет относительно других изображений.
3. auto - приоритет по умолчанию, который указывает на отсутствие предпочтения приоритета выборки. В таком случае браузер сам решает, что лучше для пользователя.

Также стоит помнить о том, что не стоит использовать атрибут `loading` если картинку гарантиованно находится в viewport.

Ленивую загрузку можно реализовать несколькими способами:

1. Атрибут `loading` в теге [`<img>`](/html/img/).
2. Intersection Observer API. Читайте подробнее в статье «[Intersection Observer](/js/intersection-observer/)».
3. Использовать progressive images.

Progressive images - это метод, который позволяет постепенно загружать изображения, начиная с низкого разрешения и постепенно улучшая его качество

Давайте разберем решение с использованием progressive images

## Готовое решение

<iframe title="Ленивая загрузка" src="demos/lazy-load/" height="350"></iframe>

## Разбор решения

Мы используем атрибут data-src, чтобы хранить ссылку на полное изображение, и атрибут src, чтобы установить начальное изображение (низкого разрешения), которое будет быстро загружено.

### Разметка

```html
<img
  src="low-resolution.jpg"
  data-src="high-resolution.jpg"
  alt="Лягушка"
  class="lazy-image"
  id="progressive-image"
>
```

### Стили

Стоит добавить картинке размеры. Это позволит для пользователей с разными размерами экрана загружать изображение подходящего размера. Данный фактор помогает улучшить результат LCP.

Также для блюра изображения в низком качестве добавлено свойсмтво [`filter`](/css/filter/)

```css
.lazy-image {
  width: 300px;
  height: 250px;
  background: no-repeat;
  background-size: cover;
  filter: blur(20px);
}
```

### Скрипт

Код на JS ожидает события DOMContentLoaded, чтобы убедиться, что весь DOM уже готов к обработке. Затем создается объект Image для загрузки изображения низкого разрешения (lowResImage). Когда это изображение загружено, мы изменяем атрибут src основного изображения (progressiveImage) на ссылку на полное изображение, которое будет загружено вместо низкого разрешения и убираем блюр

```javascript
document.addEventListener("DOMContentLoaded", function() {
    const progressiveImage = document.getElementById("progressive-image")

    const lowResImage = new Image()
    lowResImage.src = progressiveImage.src
    lowResImage.onload = function() {
        progressiveImage.src = progressiveImage.getAttribute("data-src")
        progressiveImage.style.filter = "none"
    }
})
```

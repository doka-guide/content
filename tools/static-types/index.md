---
title: "TypeScript и статическая типизация"
description: "Как TypeScript и статическая типизация помогают писать код."
cover:
  author: kirakusto
  desktop: 'images/covers/desktop.svg'
  mobile: 'images/covers/mobile.svg'
  alt: 'Несколько разных персонажей в стиле «Найди отличие в картинке», каждый чем-то отличается от других'
authors:
  - igorkamyshev
contributors:
  - furtivite
  - rrramble
editors:
  - tachisis
keywords:
  - тайпскрипт
related:
  - tools/ci-cd
  - tools/oop
  - tools/code-review
tags:
  - article
---
## Кратко

В JavaScript **слабая динамическая** типизация. Это означает две вещи:

1. При операции с переменными разных типов они будут автоматически приведены к одному типу.
1. Любая переменная может произвольно менять свой тип во время выполнения программы. (За исключением строго типизированных массивов, например `Uint8ClampedArray`)

Эти свойства языка часто усложняют разработку больших и надёжных приложений. Поэтому появились решения, которые добавляют в JavaScript **строгую статическую** типизацию. «Строгая» означает запрет автоматического приведения типов, «статическая» значит, что проверка типов происходит на этапе сборки приложения или написания кода.

Самое популярное решение в этой области — [**TypeScript**](https://www.typescriptlang.org/). Другие, менее популярные — [Rescript](https://rescript-lang.org/), [Flow](https://flow.org/) и [Hegel](https://hegel.js.org/).

## Как пользоваться

### Настройка

TypeScript — это язык, очень похожий на JavaScript. Браузеры и Node.js не могут выполнять TypeScript, поэтому его необходимо преобразовать в JavaScript.

Современные системы сборки умеют работать с TypeScript: [Vite](https://vitejs.dev/guide/features.html#typescript) и [Parcel](https://parceljs.org/languages/typescript/) поддерживают его из коробки, в [Webpack](https://webpack.js.org/guides/typescript/) и [Rollup](https://rollupjs.org/) нужно будет добавить дополнительные плагины или лоадеры. Настройки TypeScript задаются в специальном файле - _tsconfig.json_. [Структура файла _tsconfig_.json_](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html) описана на сайте TypeScriptLang.org.

```json
{
  "compilerOptions": {
    // Папка, куда попадёт результат
    "outDir": "./dist",
  },
  // Какие файлы следует компилировать
  "include": ["src/**/*"],
  // Внешние зависимости, обычно, исключают из списка компилируемых файлов
  "exclude": ["node_modules"]
}
```

После этого можно писать код в файлах с расширением _.ts_ вместо _.js_.

### Язык

Главное отличие TypeScript от JavaScript — возможность добавлять аннотации типов к переменным, аргументам функций и их возвращаемым значениям.

```ts
// Теперь переменной age можно присвоить только число
let age: number

// Будет работать
age = 43

// Выдаст ошибку
age = '34'
```

Ошибки несовпадения типов будут заметны на стадии написания кода. То есть не нужно запускать программу, чтобы узнать об ошибках в типизации.

![Сравнение процесса доставки в JS и TS](images/compare.png)

Проверка корректности типов — это разновидность [статического анализа](/tools/static-analysis/).

Примерно таким же образом можно типизировать параметры функции:

```ts
function sayMyName(name: string) {
  console.log(`Привет, ${name}`)
}

// Будет работать
sayMyName('Игорь')
// Привет, Игорь

// Выдаст ошибку
sayMyName(42)
```

В TypeScript можно типизировать не только параметры функции, но и возвращаемое значение.

```ts
function getCurrentDate(): Date {
  // Будет работать
  return new Date()
}

function getCurrentDate(): Date {
  // Выдаст ошибку
  return 'now'
}
```

Другая особенность TypeScript — строгость типизации. Он запрещает операции с переменными разных типов, чтобы не допустить неоднозначности результата.

```ts
const age = 43
const name = 'Mary'

// Выдаст ошибку, складывать числа и строки нельзя
const result = age + name
```

## Как понять

TypeScript — надмножество JavaScript. На практике это означает, что любой JavaScript-код является корректным TypeScript-кодом. А вот обратное неверно.

Главное преимущество строгой статической типизации — возможность найти ряд ошибок ещё на этапе написания кода. Например, классическая ошибка, когда в переменной не оказывается значения, приводит в JavaScript к ошибке во время выполнения, когда код уже работает в браузере.

```js
function generateEmail(user) {
  return `${user.name}@mycompany.com`
}

// При вызове функции программист передает другой объект,
// и происходит ошибка во время выполнения, пользователь её замечает
generateEmail({ fullName: 'Пётр Сергеевич Никольский' })
```

Если переписать этот пример на TypeScript, потенциальная проблема исчезнет:

```ts
// Аргумент функции всегда должен быть объектом,
// у которого есть строковое поле name
function generateEmail(user: { name: string }) {
  return `${user.name}@mycompany.com`
}

// При вызове функции программист передает другой объект,
// происходит ошибка во время сборки, программист её замечает и исправляет
generateEmail({ fullName: 'Петр Сергеевич Никольский' })

// Редактор кода или линтер укажет ошибку примерно такого содержания:
// Argument of type '{ fullName: string; }' is not assignable to parameter of type '{ name: string; }'.
```

Чем раньше обнаруживается ошибка, тем легче её исправить. Поэтому статическая типизация, [статический анализ](/tools/static-analysis/) и [написание автоматизированных тестов](/tools/how-to-test-and-why/) — это правила хорошего тона в современной разработке приложений. По сути, статическая типизация (как и статический анализ) добавляет в процесс разработки программы ещё один шаг — проверку типов, который выполняется перед сборкой проекта и может помочь найти ошибки на раннем этапе.

![Сравнение этапов доставки приложения без TypeScript и с ним](images/extra-step.png)

На первый взгляд кажется, что явное объявление типов увеличивает время разработки, так как требует писать много лишнего. Но это иллюзия. Аннотации типов — способ обеспечить большую надёжность написанного кода. Кроме этого, строгая типизация помогает компилятору эффективнее оптимизировать код.

TypeScript — это язык с опциональной типизацией. Он не заставляет программиста указывать типы, можно просто писать код как раньше. TypeScript постарается сам определить типы из контекста, и дать подсказки. Если контекст непонятен языку, он пометит тип переменной как `any`. Это означает, что в ней может лежать значение любого типа.

```ts
// Видимо, переменная должна иметь тип number
const age = 12

// Язык не знает, какой тип имеет аргумент name,
// он пометит его как any
function sayMyName(name) {
  console.log(`Привет, ${name}`)
}
```

Эта особенность языка называется выводом типов и присутствует во многих современных языках программирования. К сожалению, она не слишком развита в TypeScript, и чаще всего приходится всё-таки «подсказывать» компилятору типы. В других языках, например, в Scala, она развита сильнее, там типы приходится указывать значительно реже.

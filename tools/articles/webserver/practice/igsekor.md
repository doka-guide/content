---
tags:
  - practice
permalink: false
---

## Настройка nginx

Веб-сервер nginx был разработан в 2004 году Игорем Сысоевым для работы со статическим контентом. Проблема была в том, что при очень большом количестве пользователей основной проблемой производительности является отдача клиентам картинок, документов, CSS, HTML и JavaScript. Nginx оказался в этих задачах очень быстрым, и многие компании взяли его на вооружение. С тех пор этот веб-сервер уже стал полноценным и может выполнять множество задач, благодаря модульности.

Вы можете установить nginx с помощью [инструкции](https://nginx.org/ru/docs/install.html).

### Структура файлов конфигурации

С помощью директив описывается конфигурация и подключаются модули. Директивы делятся на простые и блочные. Например, с помощью простой директивы `listen 8080;` веб-сервер понимает, что надо прослушивать порт `8080`, на который будут приходить запросы от клиентов. Пример сложной директивы:

```
server {
  listen 8080;
  root /data/up1;

  location / {
  }
}
```

Директива означает, что сервер будет слушать порт 8080 на компьютере, на котором он будет запущен, и отдавать статические файлы из директории `/data/up1` при обращении к корневой странице сайта. Внутри фигурных скобок директивы становятся зависимыми от контекста.

Чтобы перенаправить часть запросов по URI `/` (подробнее об этом в статье «[Работа с сетью](/tools/articles/network)») приложению или службе, запущенной на компьютере и прослушивающей порт 8080, а часть запросов по пути `/images/` в директорию `/data`, нужно описать это в конфигурации:

```
server {
    location / {
        proxy_pass http://localhost:8080;
    }

    location /images/ {
        root /data;
    }
}
```

Можно фильтровать по типу файлов, используя регулярные выражения:

```
location ~ \.(gif|jpg|png)$ {
    root /data/images;
}
```

Если нужно, чтобы часть запросов перенаправлялось к интерпретатору (например, PHP), нужно описать это так:

```
server {
    location / {
        fastcgi_pass  localhost:9000;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param QUERY_STRING    $query_string;
    }

    location ~ \.(gif|jpg|png)$ {
        root /data/images;
    }
}
```

При этом веб-сервер ожидает, что соответствующий модуль прослушивает порт 9000 на этом же компьютере. Читайте подробнее в статье «[Работа с сетью](/tools/articles/network)».

### Управление конфигурацией

Запустить nginx можно напрямую, используя исполняемый файл, или в качестве службы в операционной системе.

Можно протестировать конфигурацию с помощью ключа `-t`:

```bash
nginx -t
```

Если конфигурационный файл написан правильно, то nginx об это сообщит в консоли, равно как и укажет на ошибки при их наличии.

Веб-сервером nginx можно управлять, вызывая запущенный процесс с параметром `-s`. Используйте следующий синтаксис:

```bash
nginx -s <signal>
```

Можно использовать сигналы из списка:

`stop` — быстро завершить;
`quit` — плавно завершить;
`reload` — перезагрузить конфигурационный файл;
`reopen` — открыть лог-файлы заново.

Можно получить конфигурационный файл с помощью сервиса [Mozilla SSL Configuration Generator](https://ssl-config.mozilla.org). Попробовать сгенерировать разные конфигурации позволит разобраться с конкретными настройками детальнее.

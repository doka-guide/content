### –¢–µ–æ—Ä–∏—è

–î–ª—è –Ω–∞—á–∞–ª–∞ –≤—Å–ø–æ–º–Ω–∏–º —Ä–∞–±–æ—Ç—É –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ `Promise.any`.

–ú–µ—Ç–æ–¥ `Promise.any` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—é –ø—Ä–æ–º–∏—Å–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π –ø—Ä–æ–º–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Å–∞–º–æ–≥–æ –ø–µ—Ä–≤–æ–≥–æ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–∏—Å–∞. –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–º–∏—Å—ã –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –ø—Ä–æ–º–∏—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π `AggregateError`, —Å–æ–¥–µ—Ä–∂–∞—â–µ–π –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫.

<aside>
üí° AggregateError ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –æ—à–∏–±–∫–∏ –≤ JavaScript, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—à–∏–±–æ–∫. –û–Ω –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥–µ `Promise.any()` –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–≤–æ–π—Å—Ç–≤–æ `errors`, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–µ–µ –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫.
</aside>

### –ü–æ–¥—Å–∫–∞–∑–∫–∏

–°–Ω–∞—á–∞–ª–∞ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–µ—à–∏—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ. –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –≤–æ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏:

1. –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã—Ö –ø—Ä–æ–º–∏—Å–æ–≤, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –µ—Å–ª–∏ –≤—Å–µ –æ–Ω–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å –æ—à–∏–±–∫–æ–π.
2. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –Ω–∞–π–¥—ë–º –ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
3. –ï—Å–ª–∏ –≤—Å—ë-—Ç–∞–∫–∏ –≤—Å–µ –ø—Ä–æ–º–∏—Å—ã –æ—Ç–∫–ª–æ–Ω–∏–ª–∏—Å—å, —Å–æ–∑–¥–∞—ë–º `AggregateError` —Å –º–∞—Å—Å–∏–≤–æ–º –æ—à–∏–±–æ–∫ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ.

## –†–µ—à–µ–Ω–∏–µ

–ù–∞–ø–∏—à–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–µ—Ç–æ–¥–∞ `Promise.any`:

```js
Promise.any = (iterable) => {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç –∏—Ç–µ—Ä–∏—Ä—É–µ–º—ã–π
  if (typeof iterable?.[Symbol.iterator] !== 'function') {
    return Promise.reject(new TypeError('–ê—Ä–≥—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏—Ç–µ—Ä–∏—Ä—É–µ–º—ã–º'))
  }

  // –ü—Ä–∏–≤–æ–¥–∏–º –∏—Ç–µ—Ä–∏—Ä—É–µ–º—ã–π –æ–±—ä–µ–∫—Ç –∫ –º–∞—Å—Å–∏–≤—É
  const promises = [...iterable]

  // –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤ –ø—É—Å—Ç–æ–π, —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å
  if (promises.length === 0) {
    return Promise.reject(new AggregateError([], '–í—Å–µ –ø—Ä–æ–º–∏—Å—ã –±—ã–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã'))
  }

  return new Promise((resolve, reject) => {
    const errors = []
    let rejectedCount = 0

    promises.forEach((promise, index) => {
      // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ –≤ Promise.resolve,
      // —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ–ø—Ä–æ–º–∏—Å—ã
      Promise
        .resolve(promise)
        .then(resolve) // –†–µ–∑–æ–ª–≤–∏–º —Å –ø–µ—Ä–≤—ã–º —É—Å–ø–µ—à–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
        .catch((error) => {
          errors[index] = error // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—à–∏–±–∫—É
          rejectedCount += 1

          // –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–º–∏—Å—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã, —Ñ–æ—Ä–º–∏—Ä—É–µ–º AggregateError
          if (rejectedCount === promises.length) {
            reject(new AggregateError(errors, '–í—Å–µ –ø—Ä–æ–º–∏—Å—ã –±—ã–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã'))
          }
        })
    })
  })
}
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —è–≤–ª—è—é—Ç—Å—è –∏—Ç–µ—Ä–∏—Ä—É–µ–º—ã–º–∏. –ï—Å–ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `TypeError`.
2. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏—Ç–µ—Ä–∏—Ä—É–µ–º—ã–π –æ–±—ä–µ–∫—Ç –≤ –º–∞—Å—Å–∏–≤. –ï—Å–ª–∏ –æ–Ω –ø—É—Å—Ç–æ–π, —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å —Å `AggregateError`.
3. –°–æ–∑–¥–∞—ë–º –º–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—à–∏–±–æ–∫ `errors` –∏ —Å—á—ë—Ç—á–∏–∫ –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã—Ö –ø—Ä–æ–º–∏—Å–æ–≤ `rejectedCount`.
4. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–º–∏—Å–∞:
  - –ï—Å–ª–∏ –æ–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ, –≤—ã–∑—ã–≤–∞–µ–º `resolve` —Å –µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.
  - –ï—Å–ª–∏ –æ–Ω –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—à–∏–±–∫—É –≤ `errors` –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ `rejectedCount`.
5. –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–º–∏—Å—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã, –≤—ã–∑—ã–≤–∞–µ–º `reject` —Å `AggregateError`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫.

## –¢–µ—Å—Ç—ã

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

–î–ª—è —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É:

```js
const delay = (timeout, result, shouldReject = false) =>
  new Promise((resolve, reject) =>
    setTimeout(() => (shouldReject ? reject(result) : resolve(result)), timeout)
  )
```

### –ü—Ä–∏–º–µ—Ä 1: –ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π –ø—Ä–æ–º–∏—Å

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å —Ç—Ä–∏ –ø—Ä–æ–º–∏—Å–∞ —Å —Ä–∞–∑–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –û–¥–∏–Ω –∏–∑ –Ω–∏—Ö –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π:

```js
const promise1 = delay(1000, '–ü–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π')
const promise2 = delay(500, '–í—Ç–æ—Ä–æ–π —É—Å–ø–µ—à–Ω—ã–π')
const promise3 = delay(1500, '–¢—Ä–µ—Ç–∏–π —Å –æ—à–∏–±–∫–æ–π', true)

Promise.any([promise1, promise2, promise3])
  .then(console.log) // –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: '–í—Ç–æ—Ä–æ–π —É—Å–ø–µ—à–Ω—ã–π'
  .catch(console.error)
```

### –ü—Ä–∏–º–µ—Ä 2: –≤—Å–µ –ø—Ä–æ–º–∏—Å—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã

–¢–µ–ø–µ—Ä—å –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ –≤—Å–µ –ø—Ä–æ–º–∏—Å—ã –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è —Å –æ—à–∏–±–∫–∞–º–∏:

```js
const allRejected = [
  delay(500, '–û—à–∏–±–∫–∞ 1', true),
  delay(1000, '–û—à–∏–±–∫–∞ 2', true),
  delay(1500, '–û—à–∏–±–∫–∞ 3', true)
]

Promise.any(allRejected)
  .then(console.log)
  .catch((error) => {
    console.error(error); // AggregateError: –í—Å–µ –ø—Ä–æ–º–∏—Å—ã –±—ã–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã
    console.error(error.errors) // ['–û—à–∏–±–∫–∞ 1', '–û—à–∏–±–∫–∞ 2', '–û—à–∏–±–∫–∞ 3']
  })
```

### –ü—Ä–∏–º–µ—Ä 3: —á–∏—Å–ª–æ –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç

–ü—Ä–æ–≤–µ—Ä–∏–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª–∏—Ñ–∏–ª–∞ —Å —á–∏—Å–ª–æ–º –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º:

```js
Promise.any(123)
  .then(console.log)
  .catch((error) => console.error(error)) // TypeError: '–ê—Ä–≥—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏—Ç–µ—Ä–∏—Ä—É–µ–º—ã–º'
```

### –ü—Ä–∏–º–µ—Ä 4: —Å—Ç—Ä–æ–∫–∞ –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç

–ò, –Ω–∞–∫–æ–Ω–µ—Ü, –ø—Ä–æ–≤–µ—Ä–∏–º –∫–∞–∫ `Promise.any()` –ø–æ–≤–µ–¥—ë—Ç —Å–µ–±—è —Å–æ —Å—Ç—Ä–æ–∫–æ–π:

```js
Promise.any('–¢–µ—Å—Ç')
  .then(console.log) // –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: '–¢'
  .catch(console.error)
```

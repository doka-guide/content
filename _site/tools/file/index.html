<h2>Кратко</h2>
<p>Файл — это набор сгруппированных данных, которому дали имя и записали на физическом носителе. У файлов есть атрибуты, которые говорят операционной системе, как с ними работать. Для организации сохранённых файлов используются абстрактные модели. Наибольшее распространение получили иерархические модели — деревья директорий (папок) и файлов.</p>
<h2>Как это понять</h2>
<h3>Файлы</h3>
<p>Файл — это абстракция, которая пришла из физического мира. До появления компьютеров файлом называли коробку, папку, шнур, пружину и что-то подобное, с помощью которых можно было собрать, упорядочить и хранить несколько листов бумаги вместе.</p>
<p><img src="images/files.jpg" alt="Файлы в архиве"></p>
<p>Файл — это набор данных, сохранённых на носителе информации. В процессе работы программы данные помещаются в оперативную память компьютера и обрабатываются. Все данные в компьютере представляются в виде последовательности машинных слов (байтов). Раньше машинные слова в оперативную память компьютера вводили вручную с помощью специального устройства — телетайпа. Вся последовательность машинных слов находилась в распечатанном или письменном виде на листах бумаги, которые скреплялись с помощью <em>файла</em>. Так и прижилось это понятие.</p>
<p>С появлением магнитных лент для хранения данных стали использовать другую модель — последовательность записей переменной длины. Считать с магнитной ленты данные или записать их на неё можно только последовательно (последовательный доступ). <em>Файлом</em> стали называть часть магнитной ленты с записанными на неё данными. Программисты должны были знать, с какого и по какое место на ленте записаны их данные.</p>
<p>Когда появились перфокарты, данные стали разделять на записи постоянной длины, поскольку на одной перфокарте умещалось <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%B5%D1%80%D1%84%D0%BE%D0%BA%D0%B0%D1%80%D1%82%D0%B0">определённое количество</a> машинных слов. <em>Файлом</em> стали называть набор перфокарт с нужными данными. Доступ оставался последовательным, но загрузить можно было произвольный файл, отдав компьютеру нужную стопку перфокарт.</p>
<p>Чуть позже были разработаны модели иерархической организации данных в файлах с помощью специальной структуры данных — дерева поиска. Это позволило очень быстро производить поиск по файлу. Такая модель применяется и сейчас, в специализированных системах хранения. Применение иерархической модели стало возможно, благодаря появлению носителей информации с произвольным доступом.</p>
<p>Жёсткие и гибкие диски, flash и SSD накопители реализуют произвольный доступ к данным, что позволяет читать файлы в произвольном порядке. Поэтому разработчики операционных систем снова вернулись к самой первой абстракции — представлению файла в виде последовательности байтов. Однако в этот раз ей назначили имя — имя файла.</p>
<p>Чтобы можно было отделить один файл от другого, в файл записываются атрибуты наряду с данными. Имя файла иногда выносится в отдельную сущность, но чаще записано в атрибутах. Список атрибутов зависит от конкретной операционной системы и файловой системы, которая используется в ней. Вот список наиболее распространённых атрибутов файла:</p>
<ul>
<li>имя;</li>
<li>права доступа (определяются согласно правилам операционной системы);</li>
<li>персонификация (создатель и владелец);</li>
<li>тип файла;</li>
<li>размер файла;</li>
<li>время создания файла;</li>
<li>время последней модификации;</li>
<li>время последнего обращения;</li>
<li>указатель чтения / записи (часто называют курсором или указателем);</li>
<li>и др.</li>
</ul>
<p>Практически в любой операционной системе работа с файлами осуществляется по похожему сценарию:</p>
<ol>
<li>Открытие файла (начало сессии);</li>
<li>Работа с содержимым файла и его атрибутами;</li>
<li>Закрытие файла (окончание сессии).</li>
</ol>
<p>Большинство операционных систем применяют буферизацию, чтобы не заставлять пользователя ждать окончания записи. Она происходит в фоне. При записи новых данных в файл или изменении существующих, операционная система сначала помещает данные в буфер. Если данных много, то они переносятся из буфера в файл постепенно, как во время работы с ним, так и после закрытия файла. В этом случае в интерфейсе пользователя сохранение изменений в файле происходит очень быстро, а для операционной системы существует некоторая инерция. При работе с большими файлами можно заметить как после сохранения и выхода из программы файл ещё некоторое время растёт в размере.</p>
<p>Для работы с файлами в операционной системе предусмотрены специализированные программные интерфейсы. Именно с помощью них программы получают доступ к файлам. Среди интерфейсов можно выделить типовые:</p>
<ul>
<li><code>open</code> — открытие сессии работы с файлом / создание нового файла;</li>
<li><code>close</code> — закрытие сессии работы с файлом;</li>
<li><code>read</code> / <code>write</code> — читать / писать в файл относительно положения указателя чтения / записи;</li>
<li><code>delete</code> — удалить файл;</li>
<li><code>seek</code> — позиционирование указателя чтения / записи;</li>
<li><code>rename</code> — переименование файла;</li>
<li><code>read_attributes</code> / <code>write_attributes</code> — чтение / модификация атрибутов файла.</li>
</ul>
<p>В Unix-подобных системах представление внешних устройств сводится к абстракции файла. Работа с устройством происходит через интерфейсы работы с файлами. Это позволяет унифицировать работу программ, облегчает многие задачи для пользователя по обслуживанию приложений и настройке операционной системы.</p>
<h3>Файловые системы</h3>
<p>Файловая система — абстракция, которая позволяет работать с данными на различных внешних накопителях так, чтобы для программ в операционной системе не видна была разница в аппаратной реализации. Файловая система позволяет на физическом устройстве выделять и освобождать постоянную память, заполнять её данными в асинхронном режиме, используя абстракцию файла. Кроме того, файловая система разрешает конфликты (говорят, <em>коллизии</em>) с именами файлов.</p>
<p>Один из методов решения коллизий — запретить создавать файлы с одинаковыми именами.</p>
<p>Первой моделью организации файлов была одноуровневая (или плоская) файловая система. Использовать такую файловую систему неудобно, если в операционной системе работает несколько пользователей и используется большое количество файлов. Однако одноуровневые файловые системы до сих пор применяются для определённых устройств. Например, в стиральных машинах или в микроволновых печах.</p>
<p>Продолжением одноуровневых файловых систем являются системы с фиксированным количеством уровней. Такие файловые системы используются на маршрутизаторах и телевизорах.</p>
<p>Самой успешной моделью файловой системы является иерархическая модель. Она произвела настоящую революцию в хранении данных. Иерархическая система подразумевает существование дерева данных с узлами трёх типов:</p>
<ul>
<li>корневая директория (каталог, папка) — специальный узел дерева;</li>
<li>обычная директория (каталог, папка) — обычные узлы дерева;</li>
<li>файлы — листья дерева.</li>
</ul>
<p><img src="images/file-system.png" alt="Модель иерархической файловой системы"></p>
<p>Такая структура позволяет хранить файлы в разных директориях. Полное имя файла состоит из пути до файла в дереве директорий и имени файла. Таким способом обеспечивается уникальность имён. Файлы с одинаковыми именами не создают коллизии, если хранятся в разных директориях.</p>
<p>Один уровень иерархии от другого отделяется особым символом (например, <code>/</code> для Unix-подобных систем и <code>\</code> для операционных систем на базе Windows). Поддерживаются и относительные имена файлов, из которых можно сформировать полное имя путём конкатенации (сложения строк) имени директории и относительного имени.</p>
<p>В Unix-подобных системах поддерживаются специальные директории: домашняя директория пользователя и текущая директория. Часть операционных систем вслед за Unix использует эти абстракции. Модель файловой системы Unix считается одной из наиболее удачных и безопасных, поскольку:</p>
<ul>
<li>используется очень простая, но достаточно безопасная система прав доступа;</li>
<li>поддерживаются <a href="/tools/cli/#faylovaya-sistema">символические ссылки</a>;</li>
<li>директории являются специальными файлами;</li>
<li>внешние устройства являются специальными файлами;</li>
<li>подключение внешних дисков или любых других внешних устройств обеспечивается подключением их к общей файловой системе.</li>
</ul>

<h2>Кратко</h2>
<p>Аббревиатура CI/CD означает «Continuous Integration/Continuous Delivery» — то есть «непрерывная интеграция/непрерывная доставка». Это подход к разработке, при котором задачи сборки, публикации, тестирования продукта полностью или частично автоматизированы. Очень часто автоматизация интегрирована в бизнес-процессы продуктовой команды или компании, но практики CI/CD прекрасно могут быть внедрены и в проекты, в которых участвует только один разработчик.</p>
<h2>Как понять</h2>
<p>Технологии CI/CD стали активно проникать в процессы разработки программных продуктов, когда стало очевидно, что для большинства прикладных программ великолепно подходят практики Agile, о которых можно подробнее почитать в статье «<a href="/tools/agile/">Методологии разработки и Agile</a>». Оказалось, что каждую итерацию цикла разработки можно ускорить с помощью автоматизации разных процессов. Типичную итерацию процесса разработки с применением CI/CD можно изобразить на схеме следующим образом:</p>
<p><img src="images/1.png" alt="Схема применения CI/CD на итерации типичного проекта."></p>
<p>Применение CI/CD стало очень хорошим решением, и вскоре появились первые инструменты. В мире веб-разработки это различные «<a href="/tools/bundlers/">системы сборки</a>», «<a href="/tools/package-managers/">менеджеры пакетов</a>» и инструменты для тестирования.</p>
<h2>Основные принципы</h2>
<p>Поскольку речь идёт об интеграции и доставке приложений до потребителей, набор инструментов тесно связан с системой контроля версий, серверной инфраструктурой и средствами командного взаимодействия.</p>
<p>В основе разработки и использования CI/CD лежат следующие принципы:</p>
<ul>
<li>разделение ответственности заинтересованных сторон;</li>
<li>снижение рисков;</li>
<li>короткий цикл обратной связи;</li>
<li>реализация среды.</li>
</ul>
<p>В рамках гибкой методологии разработку приложения обеспечивают владельцы продукта, маркетологи, дизайнеры, разработчики, тестировщики, инженеры по инфраструктуре, пользователи продукта. Разделение ответственности означает, что ответственность за разные стороны продукта лежит на разных ролях. Интегрировать (автоматизировать) все процессы взаимодействия между ними как раз и помогают инструменты CI/CD.</p>
<p>Например, по запросу от пользователей или владельца продукта дизайнеры дорабатывают интерфейс, разработчики пишут код, исправляют ошибки и внедряют новую функциональность. Затем в дело вступают тестировщики, которым приложение приходит в собранном виде, пройдя все необходимые автоматические проверки на качество и правильность работы кода. После успешного тестирования пользователи получают готовый к использованию продукт, отмечают баги и видят, как функциональность может быть ещё расширена. Процесс циклически повторяется вновь и вновь.</p>
<p>Применение автоматизации процессов разработки снижает риск ошибок, позволяет оперативно чинить то, что не работает. Настройка инструментов CI/CD затрагивает и такую часть разработки, как создание единого окружения, в котором ведётся разработка программного продукта. Для разработчика это крайне важно.</p>
<p>Например, использование одних и тех же npm-пакетов, их версий и инструментов тестирования позволяет разрабатывать приложение по единым стандартам качества. Случайные ошибки из-за неправильного окружения или другой операционной системы практически исключены.</p>
<h2>Этапы интеграции и доставки приложений</h2>
<p>Работа системы инструментов CI/CD основана на цикличности, что прекрасно укладывается в рамки гибкой методологии разработки программного обеспечения. Цикл применения инструментов состоит из следующих этапов:</p>
<ul>
<li>написание кода;</li>
<li>сборка;</li>
<li>ручное тестирование;</li>
<li>релиз;</li>
<li>развёртывание;</li>
<li>поддержка и мониторинг;</li>
<li>планирование.</li>
</ul>
<h3>Написание кода</h3>
<p>На этом этапе самым главным инструментом является система контроля версий. Обычно это <a href="https://git-scm.com">Git</a>. Важный элемент здесь — модель ветвления, то есть принципы использования веток в разработке. Например, в проектах на GitHub, как правило, используется модель ветвления <a href="https://guides.github.com/introduction/flow/">GitHub Flow</a>:</p>
<ol>
<li>Разработчик делает форк репозитория к себе в аккаунт на GitHub или клонирует репозиторий на компьютер. Форк — это полная копия (зеркало) репозитория на какой-то определённый момент времени, которую можно обновлять при необходимости.</li>
<li>После этого разработчик вносит изменения в форке или в локальной копии. Хорошей практикой является создание новой ветки и работы в ней.</li>
<li>Затем формируется пул-реквест — это запрос на слияние с основной веткой.</li>
<li>В рамках пул-реквеста можно проверить все предложенные изменения, обсудить решения и прийти к консенсусу.</li>
<li>После утверждения всех изменений они вливаются в основную ветку репозитория.</li>
</ol>
<p>Существуют и другие модели ветвления, например, Git-flow, о которой хорошо рассказывается в статье «<a href="https://nvie.com/posts/a-successful-git-branching-model/">A successful Git branching model</a>» на английском языке и в переводе на русском «<a href="https://habr.com/ru/post/106912/">Удачная модель ветвления для Git</a>».</p>
<h3>Сборка</h3>
<p>После написания и первичного тестирования на локальном компьютере разработчика код попадает на сервер, и производится сборка. Тестовая или готовая к публикации сборка настраивается и работает на сервере. В последнее время для сборки чаще всего используются контейнеры, например, Docker-контейнеры. Подробнее о них можно почитать в серии статей о Docker:</p>
<ul>
<li><a href="/tools/docker/">Что такое Docker</a></li>
<li><a href="/tools/dockerfile/">Как устроен Dockerfile</a></li>
<li><a href="/tools/docker-data-management/">Управление данными в Docker</a></li>
<li><a href="/tools/docker-compose/">Мультиконтейнерное приложение и Docker Compose</a></li>
</ul>
<p>Для автоматизации сборки могут использоваться различные системы. Наиболее популярные из них:</p>
<ul>
<li><a href="https://www.jenkins.io">Jenkins</a></li>
<li><a href="/tools/github-actions/">GitHub Actions</a></li>
<li><a href="https://docs.gitlab.com/ee/ci/">GitLab CI/CD</a></li>
<li><a href="https://bitbucket.org/product/features/pipelines">Bitbucket Pipelines</a></li>
<li><a href="https://www.jetbrains.com/teamcity/">JetBrains TeamCity</a></li>
</ul>
<p>Сборку поддерживают популярные и специализированные хостинги, например, <a href="https://www.netlify.com/products/build/">Netlify</a>.</p>
<h3>Тестирование</h3>
<p>После первичной подготовки кода продукту назначается версия будущего релиза с пометкой номера тестовой сборки для детального автоматизированного и ручного тестирования. Например, если номер будущего релиза <em>v.2.4.5</em>, то номер первой тестовой сборки может быть указан так: <em>v.2.4.5-1</em>. На этом этапе преобладает ручное тестирование продукта, поиск и планирование исправления ошибок. После нескольких итераций продукт признаётся готовым к релизу и переходит на следующий этап тестирования.</p>
<p>На этом этапе широко применяются интеграционные тесты, E2E-тесты, ручное и автоматизированное тестирование UI/UX. Для этого могут использоваться различные инструменты. Например, <a href="https://jestjs.io">Jest</a> может покрыть задачи модульного, интеграционного и E2E-тестирования веб-приложения. Для генерации скриншотов веб-приложения и автоматического сравнения с эталоном можно использовать <a href="https://www.selenium.dev">Selenium</a> или <a href="https://pptr.dev">Puppeteer</a>. При этом можно смоделировать не только загрузку веб-приложения и сохранить скриншоты экранов разных размеров, но и с помощью сценариев посмотреть, как будущий пользователь будет взаимодействовать с приложением.</p>
<h3>Релиз</h3>
<p>Есть разные типы цикла релизов, о которых подробно рассказывается в статье «<a href="/tools/agile/">Методологии разработки и Agile</a>». В зависимости от особенностей продукта, состава команды и задач владельцев продукта назначается периодичность релизов. Важен не только сам релиз, но и то, как работала команда на очередном витке.</p>
<p>Инструменты CI/CD на этом этапе отвечают в основном за сбор различной статистической информации. Это могут быть как пользовательские метрики (например, Яндекс.Метрика или Google Analytics), так и метрики, принятые внутри команды для отслеживания эффективности того или иного члена команды (например, можно отслеживать количество выполненных задач, скорость их выполнения, инициативность и профессиональный рост с помощью встроенных инструментов <a href="https://www.atlassian.com/ru/software/jira">Jira</a>, <a href="https://www.wrike.com">Wrike</a> или <a href="https://trello.com/home">Trello</a>).</p>
<h3>Развёртывание</h3>
<p>Наступает этап доставки продукта до конечных потребителей. Сложность развёртывания продукта связана со сложностью инфраструктуры (с архитектурой построения серверов, различными оптимизациями загрузки и работы приложения, кэшированием). Простые веб-приложения особенного внимания с точки зрения инфраструктуры не требуют. Но есть крупные онлайн-магазины, поисковые системы, стриминговые сервисы, для которых инфраструктурные задачи могут быть чуть ли не самыми важными с точки зрения конкуренции на рынке.</p>
<h3>Поддержка и мониторинг</h3>
<p>Наконец-то приложение доступно для рядовых пользователей. Здесь важны скорость и точность ответов на вопросы пользователей (то есть, организация службы поддержки пользователей) и встроенная грамотная маркетинговая политика. Для решения этих задач существует множество инструментов, но мы не будем подробно на них останавливаться, поскольку это не относится к разработке. В основном эти инструменты не сильно отличаются от инструментов для обычной офисной работы в рамках крупной компании (IP-телефония, чаты, электронная почта, различные менеджеры задач, подготовка автоматических отчётов и другие программные и аппаратные инструменты). В поддержке современных продуктов часто используются голосовые помощники и чат-боты. Практически все эти инструменты не являются инструментами CI/CD, но почти всегда предоставляют API, чтобы можно было настроить глубокую интеграцию между различными этапами для повышения качества продукта.</p>
<h3>Планирование</h3>
<p>Важным этапом является и планирование следующего цикла. На основе пользовательского опыта формируется бэклог задач для реализации, назначаются приоритеты и исполнители. После этого цикл CI/CD замыкается.</p>
<aside>
<p>👆 Необходимо помнить, что некоторые этапы CI/CD могут быть скорректированы или пропущены вовсе. Конкретная детализация зависит от конкретного продукта, состава и квалификации команды, а также особенностей выведения продукта на рынок.</p>
</aside>
<h2>Преимущества и недостатки</h2>
<p>Преимущества:</p>
<ul>
<li>Инструменты CI/CD позволяют быстро выводить программный продукт на рынок, исправлять ошибки, внедрять новую функциональность.</li>
<li>Автоматизация позволяет снизить нагрузку на членов команды, облегчает тестирование и уменьшает количество ошибок в каждой итерации. Главный плюс — это быстрая обратная связь.</li>
<li>Гибкий план позволяет быстро перераспределять ресурсы команды на решение действительно важных задач.</li>
</ul>
<p>Недостатки:</p>
<ul>
<li>Часто инструменты CI/CD воспринимаются как швейцарский нож, который может справиться с любыми задачами. При недостатке опыта это может приводить к существенному усложнению процессов в команде.</li>
<li>Инструменты CI/CD не могут решить проблемы взаимодействия внутри команды, обо всём придётся договариваться.</li>
<li>Все члены команды должны работать в единой экосистеме.</li>
</ul>

<h2>Кратко</h2>
<p>В индустрии разработки программ очень распространена практика <strong>код-ревью</strong>. Программист отправляет написанный код своим коллегам — они просматривают его и высказывают свои замечания.</p>
<p>Такой подход позволяет найти потенциальные проблемы, которые не заметил автор. Кроме того, такая практика распространяет знания внутри команды и помогает всем инженерам хорошо разбираться в коде.</p>
<h2>Как происходит</h2>
<p>Обычно разработчик отправляет на ревью набор изменений, которые решают определённую задачу — добавляют новую функциональность или исправляют ошибку. Чаще всего, такие изменения программист <a href="/tools/version-control/">делает в своей ветке</a>, а перед слиянием с основной запрашивает обзор своих изменений у коллег.</p>
<p>Отправка изменений на код-ревью происходит через <strong>пул-реквесты</strong>. Для прохождения код-ревью нужно получить одобрение одного или нескольких коллег. Способ выбора коллег для проведения ревью зависит от процессов внутри компании.</p>
<p>Пул-реквест (PR) — это предложение слить изменения в ветке разработчика с другой веткой. Иногда их называют мёрж-реквестами (MR).</p>
<p>Типичный код-ревью к пул-реквесту на GitHub выглядит так:</p>
<p><img src="images/1.png" alt="Пример обсуждения в пул-реквесте"></p>
<p>В некоторых командах код-ревью — это опциональный процесс, автор изменений сам решает, нужен ли ему сторонний взгляд. Такой подход помогает разгрузить разработчиков, не заставляя их просматривать большое количество простых правок. С другой стороны, при таком подходе на автора ложится большая ответственность за качество написанного кода.</p>
<h2><a href="https://conventionalcomments.org/">Conventional comments</a></h2>
<p>Подобные замечания не ставят приоритет комментариям, поэтому они мало полезны:</p>
<blockquote>
<p>Это неправильно сформулировано.</p>
</blockquote>
<p>Если поставить перед комментарием лэйбл, намерение станет ясным, а тон резко изменится.</p>
<blockquote>
<p><strong>suggestion</strong>: Это неправильно сформулировано.</p>
</blockquote>
<blockquote>
<p><strong>nitpick (non-blocking)</strong>: Это неправильно сформулировано.</p>
</blockquote>
<p>Лэйблы также побуждают ревьюера давать более <em>развёрнутые комментарии</em>, по которым можно сразу понять, что и где исправить.</p>
<blockquote>
<p><strong>suggestion</strong>: Это неправильно сформулировано
Можем ли мы изменить этот текст, чтобы он соответствовал формулировке со страницы маркетинга?</p>
</blockquote>
<h3>Формат</h3>
<p>Conventional comments предлагает формат, где сообщение описывается как:</p>
<pre><code>&lt;label&gt; [decorations]: &lt;subject&gt;
[discussion]
</code></pre>
<ul>
<li><code>label</code> - тип комментария;</li>
<li><code>subject</code> - основная мысль комментария;</li>
<li><code>decorations (опционально)</code> - дополнительные лэйблы для комментария. Они окружены скобками;</li>
<li><code>discussion (опционально)</code> - здесь содержатся подтверждающие заявления, контекст, рассуждения и все остальное, чтобы помочь сообщить &quot;почему&quot; и &quot;последующие шаги&quot; для разрешения замечания;</li>
</ul>
<p>Например:</p>
<blockquote>
<p><strong>question (non-blocking)</strong>: На этом этапе имеет значение, какой поток выиграл?
Может быть, чтобы предотвратить состояние гонки, мы должны продолжать зацикливаться, пока все они не выиграют?</p>
</blockquote>
<h3>Лэйблы</h3>
<p>Настоятельно рекомендуется использовать следующие лэйблы:</p>
<table>
<thead>
<tr>
<th>Лэйбл</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td>praise</td>
<td>«Похвала» подчёркивает что-то положительное. Попробуйте оставить хотя бы один такой комментарий. Не оставляйте ложных похвал (которые на самом деле могут нанести вред).</td>
</tr>
<tr>
<td>nitpick</td>
<td>«Придирки» - это небольшие, но необходимые изменения. Придирчивые комментарии значительно помогают направить внимание читателя на комментарии, требующие большего внимания.</td>
</tr>
<tr>
<td>suggestion</td>
<td>«Предложения» предоставляют способы по совершенствованию в определённой теме. Важно быть предельно ясным в том, что предлагается и почему именно это улучшение. Рассмотрите возможность использовать <em>блокирующие</em> и <em>не блокирующие</em> <a href="#dekoracii">декорации</a> для последующего информирования о ваших намерениях.</td>
</tr>
<tr>
<td>issue</td>
<td>«Проблемы» высвечивают конкретные трудности рассматриваемого вопроса. Если вы не уверены, существует проблема или нет - рассмотрите возможность оставить <em>question</em>.</td>
</tr>
<tr>
<td>question</td>
<td>«Вопросы» допустимы, если у вас есть потенциальная проблема, но не уверены уместна она или нет. Обращение к автору с просьбой о разъяснении или расследовании может привести к быстрому урегулированию этого вопроса.</td>
</tr>
<tr>
<td>thought</td>
<td>«Мысли» представляют собой идею, которая всплыла в процессе ревью. Эти замечания по своей природе <em>не блокируют</em>, но они чрезвычайно ценны и могут привести к более целенаправленным предложениям и возможностям наставничества.</td>
</tr>
<tr>
<td>chore</td>
<td>«Рутинная работа» - это небольшие задачи которые необходимо выполнить до того как пулреквест (или другая форма ревью) «официально» будут приняты. Обычно в таких комментариях упоминаются какие-то общие процессы. Постарайтесь оставить ссылку в описании на процесс, чтобы автор мог понять как именно выполнять рутинную работу.</td>
</tr>
</tbody>
</table>
<p>Не стесняйтесь отклоняться от этого конкретного списка лэйблов, если это кажется уместным.</p>
<h3>Декорации</h3>
<p>Декорации дают дополнительный контекст для комментария.</p>
<blockquote>
<p><strong>suggestion <em>(security)</em></strong>: Я немного обеспокоен тем, что мы внедряем собственную функцию очистки DOM здесь...
Можем ли мы вместо этого рассмотреть возможность использования фреймворка?</p>
</blockquote>
<blockquote>
<p><strong>suggestion <em>(test, if-minor)</em></strong>: Похоже, что мы пропустили какие-то тесты</p>
</blockquote>
<p>Декорации могут быть индивидуальными для каждой команды. Рекомендуется установить минимальный набор декораций на ваше усмотрение.</p>
<p>Возможные декорации включают:</p>
<ul>
<li><code>(non-blocking)</code> - комментарий с такой декорацией не должен препятствовать принятию рассматриваемого пулреквеста. Это полезно для команд, которые рассматривают блокирование комментариев по умолчанию.</li>
<li><code>(blocking) </code>- комментарий с такой декорацией должен препятствовать принятию рассматриваемого вопроса до тех пор, пока он не будет решён. Это полезно для команд, которые считают, что комментарии не блокируются по умолчанию.</li>
<li><code>(if-minor)</code> - эта декорация даёт автору некоторую свободу действий, которая заключается в том, что он может разрешить комментарий только в том случае, если изменения окажутся незначительными или тривиальными.</li>
</ul>
<h3>Больше примеров</h3>
<blockquote>
<p><code>@elain-mask</code>
<strong>nitpick (non-critical)</strong>: Некритично, но для консистентности папку с изображениями батутов назвал бы assets.</p>
</blockquote>
<blockquote>
<p><code>@vasya_pupkin</code>
<strong>praise</strong>: Супер! Отлично поработал над этой фичей!</p>
</blockquote>
<blockquote>
<p><code>@anonymous</code>
<strong>issue(critical)</strong>: Здесь уж слишком разбухшая логика
<strong>suggestion(critical)</strong>: Сейчас не особо больно, но по-хорошему бы декомпозировать это все дело</p>
</blockquote>
<h3>Итого</h3>
<p>Преимущества и недостатки общепринятых комментариев (они же conventional comments):</p>
<p><strong>Преимущества</strong></p>
<ul>
<li>Цель и смысл наших комментариев ясна.</li>
<li>Разделение между <em>темой</em> комментария и <em>аргументацией</em> очень чёткое и прямое.</li>
<li>Автор знает, с каким приоритетом стоит расставлять замечания, потому, что комментарии хорошо размечены.</li>
</ul>
<p><strong>Издержки</strong></p>
<ul>
<li>Категоризация комментариев может работать не всегда, <em>что-то обязательно не вместится в список</em>.</li>
<li>Формата нужно как-то обязывать придерживаться, а это дополнительные расходы на инфраструктуру или документацию.</li>
<li>Дополнительная когнитивная нагрузка при ревью.</li>
</ul>
<h3>Полезные ссылки</h3>
<ul>
<li><a href="https://conventionalcomments.org/">Conventional comments</a></li>
<li><a href="https://gist.github.com/yesnoruly/ad4554360fe6c41668186e64e28c16b7">Github saved replies</a></li>
</ul>

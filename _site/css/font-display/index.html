<h2>Кратко</h2>
<p><code>font-display</code> — это не CSS-свойство, которое можно применить к конкретному элементу. Это так называемый <strong>дескриптор</strong>. Он применяется только внутри секции правил <a href="/css/font-face/"><code>@font-face</code></a> и описывает, как будет отображаться текст в зависимости от того, загружен шрифт или нет.</p>
<h2>Пример</h2>
<pre><code class="language-css">@font-face {
  font-family: MyGreatFont;
  src:  url(my-great-font.woff) format('woff'),
        url(my-great-font.eot) format('eot');
  font-weight: 400;
  font-style: normal;
  font-display: fallback;
}
</code></pre>
<h2>Как пишется</h2>
<pre><code class="language-css">@font-face {
  font-display: auto;
  font-display: block;
  font-display: swap;
  font-display: fallback;
  font-display: optional;
}
</code></pre>
<h2>Как это понять</h2>
<p>Чтобы понять, как работает свойство <code>font-display</code>, нужно сделать небольшой экскурс в анатомию загрузки и использования шрифтов.</p>
<p>Для начала пара определений.</p>
<h3>Запасной шрифт</h3>
<p>В свойстве <a href="/css/font-family/"><code>font-family</code></a> мы можем через запятую перечислять несколько шрифтов.</p>
<p>С точки зрения браузера <em>запасным</em> является первый из перечисленных шрифтов, который уже загружен. Попытка отобразить запасной шрифт не должна вызывать его загрузки.</p>
<h3>Невидимый запасной шрифт</h3>
<p>Сначала браузер находит <em>запасной шрифт</em>. Затем создаёт анонимное начертание (анонимный <code>font-face</code>) с использованием метрик <em>запасного шрифта</em>, но оставляет все символы незакрашенными (невидимыми) и использует это начертание для рендеринга текста. Текст остаётся невидимым, но занимаемое им место рассчитывается исходя из метрик <em>запасного шрифта</em>. Использование невидимого запасного шрифта не должно вызывать его загрузки.</p>
<p>В процессе загрузки страницы браузер должен отображать текстовое содержимое. Для любого символа на странице так или иначе определён шрифт, которым отображается этот символ. Зачастую на странице используются нестандартные шрифты, которых с большой долей вероятности нет в операционной системе пользователя. Для того чтобы такие шрифты подключить к странице, используется блок правил <a href="/css/font-face/"><code>@font-face</code></a>.</p>
<p>Для таких шрифтов в тот момент, когда символ должен показаться на странице, а шрифт ещё не загружен, запускается временная шкала загрузки. Он состоит из трёх этапов:</p>
<ol>
<li>Период блокировки;</li>
<li>Период замены;</li>
<li>Период сбоя.</li>
</ol>
<p>Рассмотрим этапы подробнее.</p>
<h3>Период блокировки</h3>
<p>Если шрифт ещё не загружен, то в этот период любой элемент, который использует этот шрифт, должен быть отображён с использованием невидимого запасного шрифта.</p>
<p>Если шрифт успешно подгружается в период блокировки, то он используется, как обычно.</p>
<h3>Период замены</h3>
<p>Этот период следует непосредственно за периодом блокировки. В это время, если необходимый шрифт ещё не загружен, любой элемент, который использует этот шрифт, должен быть отображён запасным шрифтом. Если в период замены шрифт будет успешно загружен, то он будет использоваться, как обычно.</p>
<h3>Период сбоя</h3>
<p>Начинается сразу после периода замены. Если к этому времени необходимый шрифт ещё не загружен, то он помечается как неудачно загруженный и вместо него используется запасной шрифт. Если же шрифт загружен, то он используется, как обычно.</p>
<p>Теперь вернёмся к <code>font-display</code>. Значения этого свойства определяют длительность периодов таймлайна загрузки шрифта.</p>
<p><code>auto</code> — стратегия загрузки шрифта определяется браузером в автоматическом режиме. То есть, какую длительность периодов заложили разработчики браузера, такая и будет применяться. Зачастую эта стратегия очень близка к той, что задаётся значением <code>block</code>.</p>
<p><code>block</code> — стратегия загрузки шрифта, при которой задаётся короткий (порядка 3 секунд) период блокировки и бесконечный период замены. Другими словами, пока грузится шрифт, браузер весь текст показывает невидимым запасным шрифтом, а после загрузки шрифта переключается на этот шрифт.</p>
<p>Используем это значение в исключительных случаях. Например, если страницу невозможно нормально использовать без именно этого шрифта. Яркий пример: иконочный шрифт. До момента загрузки такого шрифта при других стратегиях браузер будет показывать обычный символ алфавита вместо иконки, что может сбить с толку и не дать нормально пользоваться страницей.</p>
<p><code>swap</code> — задаёт очень короткий (менее 100 миллисекунд) период блокировки и бесконечный период замены. При такой стратегии браузер практически сразу отображает текст запасным шрифтом, а затем, когда подгружен нужный шрифт, переключается на него.</p>
<p>Используем это значение, когда раннее отображение текста является приоритетной задачей, но отображение текста другим шрифтом не нарушает нормального использования страницы. Желательно такую стратегию применять только к небольшим фрагментам текста. Яркий пример: отображение логотипа компании. В целом другой шрифт не усложнит пользование страницей, но правильный логотип важен с точки зрения продвижения бренда.</p>
<p><code>fallback</code> — такая стратегия, при которой задаётся очень короткий (менее 100 миллисекунд) период блокировки, а так же короткий (порядка 3 секунд) период замены. В этом случае браузер практически сразу отображает текст запасным шрифтом, затем, когда подгружен нужный шрифт, переключается на него, но если шрифт не загрузился, остаётся на запасном шрифте.</p>
<p>Желательно это значение использовать для основного текста, а так же для больших фрагментов текста. Как правило, это значение используется в ситуациях, когда желательно отобразить текст нужным шрифтом, но ничего страшного, если этот текст будет написан другим шрифтом. Использование этого значения помогает сразу же отобразить текст страницы, чтобы пользователь мог прочитать его как можно раньше.</p>
<p><code>optional</code> — самая сложная стратегия: период блокировки очень короткий (порядка 100 миллисекунд), а вот период замены не задан.</p>
<p>Это значит, что если шрифт стал доступен в период блокировки (то есть, <strong>очень быстро</strong>), то он и будет использоваться. В противном случае браузер считает, что ни в период блокировки, ни в период замены шрифт загрузить не удалось. Если к этому моменту шрифт ещё не понадобился для отрисовки элемента, браузер будет решать отменить загрузку этого шрифта или продолжить с очень низким приоритетом.</p>
<p>Более того, если браузер решит, что отображение текста <strong>важно</strong> для пользователя, то он может вообще не начинать загрузку шрифта, а сразу показать запасной шрифт.</p>
<p>Это значение лучше использовать для основного текста либо такого текста, отображение которого нужным шрифтом больше «приятное дополнение», нежели необходимость. Используем это значение, когда нужно отобразить текст как можно быстрее, а дизайнерская точность не является приоритетом.</p>
<h2>Подсказки</h2>
<p>💡 В чём же отличие <code>fallback</code> от <code>optional</code>?</p>
<p>При <code>fallback</code> браузер имеет порядка 3 секунд, чтобы переключиться с запасного шрифта на нужный.</p>
<p>При <code>optional</code> браузер может решить, что важнее показать текст как можно скорее и переключения на основной шрифт может вообще не произойти.</p>
<p>Важно понимать, что и при <code>fallback</code> и при <code>optional</code> даже при успешной загрузке нужного шрифта переключение на него может не случиться.</p>

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HWB — Цвета в вебе — Дока</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet" />
  <style>
    html {
      color-scheme: dark;
    }
  
    body {
      font-family: sans-serif;
      background: #18191c;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
  
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      max-width: 800px;
      width: 100%;
      padding: 20px;
    }
  
    #color-block {
      flex: 1 1 300px;
      height: 200px;
      border-radius: 8px;
      border: 1px solid #ffffff33;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: monospace;
      text-align: center;
      font-size: 1rem;
      padding: 10px;
      transition: color 0.3s ease;
    }
  
    .color-params {
      flex: 1 1 300px;
      display: flex;
      justify-content: center;
      flex-direction: column;
      gap: 15px;
    }
  
    .input-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }
  
    input[type="range"] {
      flex-grow: 1;
    }
  
    input[type="number"] {
      width: 70px;
    }
  
    label {
      font-size: 0.9rem;
      flex-shrink: 0;
      width: fit-content;
    }
  </style>
  </head>
  <body>
    <div class="container">
      <div id="color-block">hwb(0 0% 100% / 1)</div>
      <div class="color-params">
        <div class="input-group">
          <label for="h">H (оттенок):</label>
          <input type="range" id="h" min="0" max="360" value="0">
          <input type="number" id="h-num" min="0" max="360" value="0">
        </div>
        <div class="input-group">
          <label for="w">W (количество белого):</label>
          <input type="range" id="w" min="0" max="100" value="0">
          <input type="number" id="w-num" min="0" max="100" value="0">
        </div>
        <div class="input-group">
          <label for="b">B (количество чёрного):</label>
          <input type="range" id="b" min="0" max="100" value="100">
          <input type="number" id="b-num" min="0" max="100" value="100">
        </div>
        <div class="input-group">
          <label for="a">α (альфа канал):</label>
          <input type="range" id="a" min="0" max="1" step="0.01" value="1">
          <input type="number" id="a-num" min="0" max="1" step="0.01" value="1">
        </div>
      </div>
    </div>  

  <script>
    const refs = {
      h: document.getElementById("h"),
      w: document.getElementById("w"),
      b: document.getElementById("b"),
      a: document.getElementById("a"),
      hNum: document.getElementById("h-num"),
      wNum: document.getElementById("w-num"),
      bNum: document.getElementById("b-num"),
      aNum: document.getElementById("a-num"),
      block: document.getElementById("color-block")
    };

    function getRelativeLuminance(r, g, b) {
      const srgb = [r, g, b].map((v) => {
        v /= 255;
        return v <= 0.03928
          ? v / 12.92
          : Math.pow((v + 0.055) / 1.055, 2.4);
      });
      return 0.2126 * srgb[0] + 0.7152 * srgb[1] + 0.0722 * srgb[2];
    }

    function hwbToRgb(h, w, b) {
      const ratio = w + b;
      if (ratio > 100) {
        w = (w / ratio) * 100;
        b = (b / ratio) * 100;
      }

      const c = (1 - b / 100 - w / 100);
      const [r1, g1, b1] = hslToRgb(h, 1, 0.5);
      const r = r1 * c + (w / 100);
      const g = g1 * c + (w / 100);
      const bl = b1 * c + (w / 100);
      return [r * 255, g * 255, bl * 255];
    }

    function hslToRgb(h, s, l) {
      h /= 360;
      let r, g, b;

      if (s === 0) {
        r = g = b = l;
      } else {
        const hue2rgb = (p, q, t) => {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1 / 6) return p + (q - p) * 6 * t;
          if (t < 1 / 2) return q;
          if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
          return p;
        };

        const q = l < 0.5
          ? l * (1 + s)
          : l + s - l * s;
        const p = 2 * l - q;

        r = hue2rgb(p, q, h + 1 / 3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1 / 3);
      }

      return [r, g, b];
    }

    function updateColor() {
      const h = parseFloat(refs.h.value);
      const w = parseFloat(refs.w.value);
      const bl = parseFloat(refs.b.value);
      const a = parseFloat(refs.a.value);

      const color = `hwb(${h} ${w}% ${bl}% / ${a})`;
      refs.block.style.backgroundColor = color;
      refs.block.textContent = color;

      const [r, g, b] = hwbToRgb(h, w, bl);
      const luminance = getRelativeLuminance(r, g, b);
      refs.block.style.color = luminance > 0.5 ? "#000" : "#fff";
    }

    function syncFromSliders() {
      refs.hNum.value = refs.h.value;
      refs.wNum.value = refs.w.value;
      refs.bNum.value = refs.b.value;
      refs.aNum.value = refs.a.value;
      updateColor();
    }

    function syncFromNumbers() {
      refs.h.value = refs.hNum.value;
      refs.w.value = refs.wNum.value;
      refs.b.value = refs.bNum.value;
      refs.a.value = refs.aNum.value;
      updateColor();
    }

    ["h", "w", "b", "a"].forEach((key) => {
      refs[key].addEventListener("input", syncFromSliders);
      refs[key + "Num"].addEventListener("input", syncFromNumbers);
    });

    updateColor();
  </script>
</body>
</html>

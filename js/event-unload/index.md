---
title: "Событие `unload`"
description: "Обработка закрытия страницы"
authors:
  - kotosha-real
tags:
  - doka
---

## Кратко

Когда пользователь уходит со страницы, генерируется событие `unload`. Мы можем отреагировать на него, [подписавшись на это событие](/js/events/) у объекта `window`.

## Как пишется

```js
window.addEventListener('unload', function () {
  // ...
})
```

## Как это понять

В современном вебе всё увешано трекингом: клики, переходы, прокрутка до определённых секций и ещё куча всего. Почему бы не трекать уход пользователя со страницы?

```js
window.addEventListener('unload', function () {
  const someUsefulData = getSomeUsefulData();

  navigator.sendBeacon('/some-endpoint', someUsefulData);
})
```

Что происходит в коде выше? Когда пользователь покинет страницу, функция `getSomeUsefulData` соберёт аналитическую информацию, а метод `sendBeacon` отправит её по адресу `/some-endpoint`. Метод `sendBeacon` — это неблокирующий метод отправки данных, почитать про него подробнее можно [тут](https://w3c.github.io/beacon/). А [вот](https://caniuse.com/?search=sendbeacon) его поддержка.

> Неблокирующая отправка означает, что она будет выполнена асинхронно и не будет мешать выгрузке текущей страницы и загрузке следующей.
> Раньше разработчики использовали ~~костыльные~~ специальные техники, чтобы отправить что-либо в момент закрытия страницы, например:
> - Синхронные вызовы `XMLHttpRequest`.
> - Картинки со специальными `src` (так называемые пиксели).
> - Иногда даже создавались пустые циклы на несколько секунд.
>
> Метод `sendBeacon` позволяет ~~не заниматься этой вакханалией~~ отправить данные надёжно и асинхронно, не мешая нормальному ходу вещей.

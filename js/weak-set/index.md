---
title: "`WeakSet`"
description: "Коллекция, в которой временно хранятся уникальные объекты."
authors:
  - ra1nbow1
keywords:
  - keyed collection
  - javascript collection
related:
  - js/collection-weakmap
  - js/map
  - js/set
tags:
  - doka
---

## Кратко

`WeakSet` — встроенная коллекция в JavaScript, представляющая собой набор [объектов]((/js/object/)) и незарегистрированных символов, каждый из которых может быть добавлен только один раз. В отличие от обычного [`Set`]((/js/set/)), `WeakSet` допускает только объекты и незарегистрированные символы в качестве элементов. Основное назначение `WeakSet` — временное хранение таких элементов, которые могут быть удалены из памяти, если на них нет других ссылок. Это делает коллекцию полезной для управления памятью, поскольку позволяет сборщику мусора автоматически освобождать память, предотвращая утечки.

Однако важно отметить, что в JavaScript управление памятью осуществляется автоматически сборщиком мусора, и разработчик не имеет прямого контроля над этим процессом. Использование этой структуры данных помогает оптимизировать использование памяти, но не предоставляет полного контроля над её управлением.

Одна из ключевых особенностей `WeakSet` — элементы в этой коллекции слабо связаны. Это означает, что коллекция хранит слабые ссылки на свои элементы. Слабая ссылка — это ссылка на объект, которая не препятствует его удалению сборщиком мусора. Если на объект больше нет сильных ссылок (т.е. обычных ссылок, удерживающих объект в памяти), сборщик мусора может автоматически удалить этот объект, даже если он находится в WeakSet.

## Пример

```js
var ws = new WeakSet()
var obj = {}
var foo = {}

// Добавляем глобальный объект window в WeakSet
ws.add(window)

// Добавляем объект obj
ws.add(obj)

console.log(ws.has(window))
// true, window присутствует в WeakSet

console.log(ws.has(foo))
// false, foo не был добавлен

// Удаляем window из WeakSet
ws.delete(window)

console.log(ws.has(window))
// false, window больше нет в WeakSet
```

## Как пишется

`WeakSet` полезен для временного хранения объектов без удержания их в памяти дольше необходимого. Например, при отслеживании DOM-элементов, которые могут быть удалены, `WeakSet` позволяет автоматически «забывать» об этих объектах, предотвращая утечки памяти.

Пример использования `WeakSet` — хранение метаданных о [DOM-элементах](/js/dom/), чтобы не препятствовать их удалению, когда они больше не нужны.

### Особенности

**Слабые ссылки**. Элементы `WeakSet` не предотвращают сборку мусора. Если на объект остаются только слабые ссылки, он может быть удалён из памяти. В контексте `WeakSet` это означает, что нахождение объекта в коллекции не предотвращает его сборку мусора, если на него больше нет сильных ссылок. **Сильная ссылка** - это обычная ссылка на объект, которая удерживает его в памяти и предотвращает его удаление сборщиком мусора. Пока на объект существуют сильные ссылки, он остаётся в памяти. В JavaScript все стандартные ссылки, такие как присваивание объекта переменной, являются сильными.

**Нет итерирования**. В `WeakSet` нет методов для перебора элементов, например, [`forEach`](/js/set-foreach/). Причина — это потенциально препятствует сборщику мусора удалять объекты. В результате `WeakSet` является непрозрачной коллекцией: вы не можете узнать, какие объекты хранятся в ней. Единственный способ проверить наличие конкретного объекта — метод [`has()`](/js/set-has/).

**Уникальность объектов**. Все объекты в `WeakSet` уникальны вне зависимости от количества попыток добавить один и тот же элемент.

### Методы

`add(value)` добавляет объект в коллекцию `WeakSet`. Возвращает экземпляр `WeakSet`, что позволяет использовать методы цепочкой.

Параметр `value` у [`add()`](/js/set-add/) — объект, который добавится в `WeakSet`.

Пример с `add()`:

```js
var ws = new WeakSet()
var obj = {}
ws.add(obj)
```

`has(value)` проверяет присутствие объекта в `WeakSet`. Возвращает булево значение `true`, если объект присутствует, и `false` в противном случае.

У `has()` может быть параметр `value`. Это объект, наличие которого нужно проверить.

Пример с `has()`:

```js
ws.has(obj)
// true
```

`delete(value)` удаляет объект из `WeakSet`, если он присутствует. Возвращает булево значение `true`, если объект удалён, и `false`, если объект не найден в коллекции.

Параметр [`delete()`](/js/set-delete/) — `value`. Это объект, который удаляем.

Пример использования `delete()`:

```js
ws.delete(obj)
ws.has(obj)
// false
```

### Ограничения

- `WeakSet` поддерживает только объекты, [примитивы](/js/#primitivnye-tipy-dannyh) (строки, числа, булевы значения) добавить нельзя.
- Невозможно узнать, сколько объектов хранится в `WeakSet`, так как сборщик мусора может автоматически их удалить.
- `WeakSet` не даёт итерироваться (перемещаться) по элементам коллекции.

### Отличия от `Set`

`Set` и `WeakSet` отличаются друг от друга. Во-первых, в `WeakSet` хранятся только объекты. В `Set` можете хранить любые типы данных.

Второе отличие — элементы `WeakSet` слабо связаны, что позволяет сборщику мусора удалять их, когда они больше не нужны. В `Set` этого не происходит.

Последнее отличие — в `WeakSet` нельзя перебирать элементы или узнать их количество. В `Set` для этого доступны разные методы. Например, `size`, итерирование через `forEach()` и другие.

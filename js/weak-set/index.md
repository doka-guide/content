---
title: "`WeakSet`"
description: "Коллекция, в которой временно хранятся уникальные объекты."
authors:
  - ra1nbow1
keywords:
  - keyed collection
  - javascript collection
related:
  - js/collection-weakmap
  - js/map
  - js/set
tags:
  - doka
---

## Кратко

Коллекция из пар ключ-значение, которая временно хранит объекты и/или символы. Все элементы уникальные и могут быть добавлены в такую коллекцию один раз. Как и [`WeakMap`](/js/collection-weakmap/), `WeakSet` нужна для сборщика мусора.

## Описание

`WeakSet` — это встроенная коллекция в JavaScript, которая представляет собой набор объектов, где каждый объект может быть добавлен только один раз. В отличие от обычного `Set`, `WeakSet` допускает только объекты в качестве элементов. Основное его назначение — временное хранение объектов, которые могут быть удалены из памяти, если на них нет других ссылок, что делает его полезным для управления памятью.

Одной из ключевых особенностей `WeakSet` является то, что элементы в этой коллекции слабо связаны. Это означает, что если объект больше не используется в программе (и на него нет других ссылок), он может быть автоматически удалён сборщиком мусора, даже если он находится в `WeakSet`.

## Особенности

- Только объекты: В отличие от `Set`, который может содержать любые типы значений, `WeakSet` принимает только объекты в качестве элементов. Примитивные значения, такие как строки, числа или булевые значения, не могут быть добавлены.
- Слабые ссылки: Элементы `WeakSet` не предотвращают сборку мусора. Если объект, добавленный в `WeakSet`, больше не используется в коде и на него нет сильных ссылок, он может быть автоматически удалён.
- Нет итерирования: В `WeakSet` нет методов для перебора элементов, таких как `forEach`, потому что это могло бы препятствовать сборщику мусора от удаления объектов. В результате `WeakSet` является непрозрачной коллекцией: вы не можете узнать, какие объекты в нём хранятся, кроме как проверять наличие конкретного объекта с помощью метода `has()`.
- Уникальность объектов: Как и в `Set`, каждый объект в `WeakSet` может быть добавлен только один раз.

## Методы

1. `add(value)` - добавляет объект в коллекцию `WeakSet`. Возвращает экземпляр `WeakSet`, что позволяет использовать методы цепочкой.

Параметры:
- `value`: Объект, который будет добавлен в `WeakSet`.

Пример:

```js
var ws = new WeakSet();
var obj = {};
ws.add(obj);
```

2. `has(value)` - проверяет, присутствует ли объект в `WeakSet`. Возвращает булевое значение `true`, если объект присутствует, и `false` в противном случае.

Параметры:
- `value`: Объект, наличие которого нужно проверить.

Пример:

```js
ws.has(obj); // true
```

3. delete(value) - удаляет объект из `WeakSet`, если он там присутствует. Возвращает булевое значение `true`, если объект был удалён, и `false`, если объект не был найден в коллекции.

Параметры:
- `value`: Объект, который нужно удалить.

Пример:
```js
ws.delete(obj);
ws.has(obj); // false
```

## Пример использования
```js
var ws = new WeakSet();
var obj = {};
var foo = {};

ws.add(window); // Добавляем глобальный объект window в WeakSet
ws.add(obj);    // Добавляем объект obj

console.log(ws.has(window)); // true, window присутствует в WeakSet
console.log(ws.has(foo));    // false, foo не был добавлен

ws.delete(window);  // Удаляем window из WeakSet
console.log(ws.has(window)); // false, window больше нет в WeakSet
```

## Где и как использовать
`WeakSet` полезен в ситуациях, когда вам нужно хранить объекты временно, не удерживая их в памяти дольше, чем это необходимо. Например, если у вас есть система слежения за объектами, которая должна автоматически забывать об объектах, когда они больше не используются в коде. В этих случаях использование `WeakSet` позволяет избежать утечек памяти.

Пример использования `WeakSet` — хранение метаданных о DOM-элементах, чтобы не препятствовать их удалению, когда они больше не нужны.

## Отличие от `Set`

- В `WeakSet` могут храниться только объекты, в то время как в `Set` можно хранить любые типы данных.
- Элементы `WeakSet` слабо связаны, что позволяет сборщику мусора удалять их, когда они больше не нужны. В `Set` этого не происходит.
- В `WeakSet` нельзя перебирать элементы или узнать их количество, тогда как в `Set` доступны такие методы, как `size`, итерирование через `forEach()` и другие.

## Ограничения

- `WeakSet` поддерживает только объекты, примитивы (строки, числа, булевые значения) не могут быть добавлены.
- Нет возможности узнать, сколько объектов хранится в `WeakSet`, поскольку они могут быть автоматически удалены сборщиком мусора.
- Невозможно итерировать по элементам `WeakSet`.

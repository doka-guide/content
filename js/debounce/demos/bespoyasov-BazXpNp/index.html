<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>CodePen - doka-debounce-search-form</title>
</head>
<body>
<form action="/some-route" method="GET" id="search">
  <label>Find your favourite pizza:</label>
  <input type="search" name="query" placeholder="Margherita">
  <button>Search!</button>
</form>

<ul class="search-results"></ul>
  <script>
    const pizzaList = [
      'Margherita',
      'Pepperoni',
      'Hawaii',
      '4 Cheeses',
      'Diabola',
      'Sfincione'
    ];

    function contains(query) {
      return pizzaList.filter(title =>
        title.toLowerCase().includes(query.toLowerCase()));
    }

    const server = {
      search(query) {
        console.log(query);
        return new Promise(resolve => {
          setTimeout(() => resolve({
            list: query ? contains(query) : []
          }), 100)
        })
      }
    }

    const searchForm = document.getElementById('search');
    const searchInput = searchForm.querySelector('[type="search"]');
    const searchResults = document.querySelector('.search-results');

    function debounce(callee, timeoutMs) {
      return function perform(...args) {
        let previousCall = this.lastCall;
        this.lastCall = Date.now();

        if (previousCall && ((this.lastCall - previousCall) <= timeoutMs)) {
          clearTimeout(this.lastCallTimer);
        }

        this.lastCallTimer = setTimeout(() => callee(...args), timeoutMs);
      }
    }

    function handleInput(e) {
      const {value} = e.target;

      server.search(value).then(function (response) {
        const {list} = response;

        const html = list.reduce((markup, item) => {
          return `${markup}<li>${item}</li>`;
        }, ``);

        searchResults.innerHTML = html;
      })
    }

    const debouncedHandle = debounce(handleInput, 250);
    searchInput.addEventListener('input', debouncedHandle);
  </script>
</body>
</html>
